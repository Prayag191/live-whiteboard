<!DOCTYPE html>
<html>
<head>
    <title>Live Whiteboard</title>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

    <style>
        body { margin:0; }
        canvas {
            border:2px solid black;
            background:white;
            display:block;
            margin:20px auto;
        }
    </style>
</head>
<body>

<canvas id="board" width="1200" height="600"></canvas>

<script>
    const canvas = document.getElementById("board");
    const ctx = canvas.getContext("2d");

    let drawing = false;
    let stompClient = null;

    function connectWebSocket() {

        const socket = new SockJS("/ws");
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function () {
            console.log("Connected");

            stompClient.subscribe("/topic/board", function (message)  {
                const data = JSON.parse(message.body);
                draw(data.x, data.y, data.type);
            });
        });
    }

    function draw(x, y, type) {
        if (type === "start") {
            ctx.beginPath();
            ctx.moveTo(x, y);
        } else if (type === "draw") {
            ctx.lineTo(x, y);
            ctx.stroke();
        }
    }

    canvas.addEventListener("mousedown", (e) => {
        drawing = true;
        sendData(e.offsetX, e.offsetY, "start");
    });

    canvas.addEventListener("mousemove", (e) => {
        if (!drawing) return;
        sendData(e.offsetX, e.offsetY, "draw");
    });

    canvas.addEventListener("mouseup", () => {
        drawing = false;
    });

    function sendData(x, y, type) {
        if (stompClient && stompClient.connected) {
            stompClient.send("/app/draw", {}, JSON.stringify({
                x: x,
                y: y,
                type: type
            }));
        }
    }

    connectWebSocket();
</script>

</body>
</html>